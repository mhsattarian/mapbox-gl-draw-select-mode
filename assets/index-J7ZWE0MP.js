import gr from"https://unpkg.com/@mapbox/mapbox-gl-draw@1.3.0/src/lib/theme.js";(function(){const O=document.createElement("link").relList;if(O&&O.supports&&O.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))F(x);new MutationObserver(x=>{for(const Z of x)if(Z.type==="childList")for(const Je of Z.addedNodes)Je.tagName==="LINK"&&Je.rel==="modulepreload"&&F(Je)}).observe(document,{childList:!0,subtree:!0});function S(x){const Z={};return x.integrity&&(Z.integrity=x.integrity),x.referrerPolicy&&(Z.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?Z.credentials="include":x.crossOrigin==="anonymous"?Z.credentials="omit":Z.credentials="same-origin",Z}function F(x){if(x.ep)return;x.ep=!0;const Z=S(x);fetch(x.href,Z)}})();var Qe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yr(m){return m&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m}var ao={exports:{}};(function(m,O){(function(S,F){m.exports=F()})(Qe,function(){var S=function(e,t){var n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},o={on:function(i,a,l){if(n[i]===void 0)throw new Error("Invalid event type: "+i);n[i].push({selector:a,fn:l})},render:function(i){t.store.featureChanged(i)}},r=function(i,a){for(var l=n[i],d=l.length;d--;){var h=l[d];if(h.selector(a)){h.fn.call(o,a)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(o),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(i){r("drag",i)},click:function(i){r("click",i)},mousemove:function(i){r("mousemove",i)},mousedown:function(i){r("mousedown",i)},mouseup:function(i){r("mouseup",i)},mouseout:function(i){r("mouseout",i)},keydown:function(i){r("keydown",i)},keyup:function(i){r("keyup",i)},touchstart:function(i){r("touchstart",i)},touchmove:function(i){r("touchmove",i)},touchend:function(i){r("touchend",i)},tap:function(i){r("tap",i)}}};function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function x(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function o(){if(this instanceof o){var r=[null];r.push.apply(r,arguments);var i=Function.bind.apply(t,r);return new i}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(o){var r=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(n,o,r.get?r:{enumerable:!0,get:function(){return e[o]}})}),n}var Z={},Je={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},an=Je;function sn(e){var t=0;if(e&&e.length>0){t+=Math.abs(wt(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(wt(e[n]))}return t}function wt(e){var t,n,o,r,i,a,l=0,d=e.length;if(d>2){for(a=0;a<d;a++)a===d-2?(o=d-2,r=d-1,i=0):a===d-1?(o=d-1,r=0,i=1):(o=a,r=a+1,i=a+2),t=e[o],n=e[r],l+=(Pt(e[i][0])-Pt(t[0]))*Math.sin(Pt(n[1]));l=l*an.RADIUS*an.RADIUS/2}return l}function Pt(e){return e*Math.PI/180}Z.geometry=function e(t){var n,o=0;switch(t.type){case"Polygon":return sn(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)o+=sn(t.coordinates[n]);return o;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)o+=e(t.geometries[n]);return o}},Z.ring=wt;var Q={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},te={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},D={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},X={POLYGON:"polygon",LINE:"line_string",POINT:"point"},_={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},C={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ee={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},At={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},$={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},J={ACTIVE:"true",INACTIVE:"false"},un=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Dt=-85,lo=Object.freeze({__proto__:null,classes:Q,sources:te,cursors:D,types:X,geojsonTypes:_,modes:C,events:ee,updateActions:At,meta:$,activeStates:J,interactions:un,LAT_MIN:-90,LAT_RENDERED_MIN:Dt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),cn={Point:0,LineString:1,MultiLineString:1,Polygon:2};function po(e,t){var n=cn[e.geometry.type]-cn[t.geometry.type];return n===0&&e.geometry.type===_.POLYGON?e.area-t.area:n}function ln(e){return e.map(function(t){return t.geometry.type===_.POLYGON&&(t.area=Z.geometry({type:_.FEATURE,property:{},geometry:t.geometry})),t}).sort(po).map(function(t){return delete t.area,t})}function dn(e,t){return t===void 0&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function ne(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,n=e.length;t<n;t++)this.add(e[t]),e[t]!==void 0&&(typeof e[t]=="string"?this._items[e[t]]=t:this._nums[e[t]]=t)}ne.prototype.add=function(e){return this.has(e)||(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length),this},ne.prototype.delete=function(e){return this.has(e)===!1||(this._length--,delete this._items[e],delete this._nums[e]),this},ne.prototype.has=function(e){return(typeof e=="string"||typeof e=="number")&&(this._items[e]!==void 0||this._nums[e]!==void 0)},ne.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach(function(n){t.push({k:n,v:e._items[n]})}),Object.keys(this._nums).forEach(function(n){t.push({k:JSON.parse(n),v:e._nums[n]})}),t.sort(function(n,o){return n.v-o.v}).map(function(n){return n.k})},ne.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var fo=[$.FEATURE,$.MIDPOINT,$.VERTEX],De={click:function(e,t,n){return pn(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return pn(e,t,n,n.options.touchBuffer)}};function pn(e,t,n,o){if(n.map===null)return[];var r=e?dn(e,o):t,i={};n.options.styles&&(i.layers=n.options.styles.map(function(h){return h.id}).filter(function(h){return n.map.getLayer(h)!=null}));var a=n.map.queryRenderedFeatures(r,i).filter(function(h){return fo.indexOf(h.properties.meta)!==-1}),l=new ne,d=[];return a.forEach(function(h){var g=h.properties.id;l.has(g)||(l.add(g),d.push(h))}),ln(d)}function nt(e,t){var n=De.click(e,null,t),o={mouse:D.NONE};return n[0]&&(o.mouse=n[0].properties.active===J.ACTIVE?D.MOVE:D.POINTER,o.feature=n[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(o.mouse=D.ADD),t.ui.queueMapClasses(o),t.ui.updateMapClasses(),n[0]}function Rt(e,t){var n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}function Ut(e,t,n){n===void 0&&(n={});var o=n.fineTolerance!=null?n.fineTolerance:4,r=n.grossTolerance!=null?n.grossTolerance:12,i=n.interval!=null?n.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var a=Rt(e.point,t.point);return a<o||a<r&&t.time-e.time<i}function kt(e,t,n){n===void 0&&(n={});var o=n.tolerance!=null?n.tolerance:25,r=n.interval!=null?n.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,Rt(e.point,t.point)<o&&t.time-e.time<r}var fn={exports:{}},jt=fn.exports=function(e,t){if(t||(t=16),e===void 0&&(e=128),e<=0)return"0";for(var n=Math.log(Math.pow(2,e))/Math.log(t),o=2;n===1/0;o*=2)n=Math.log(Math.pow(2,e/o))/Math.log(t)*o;var r=n-Math.floor(n),i="";for(o=0;o<Math.floor(n);o++)i=Math.floor(Math.random()*t).toString(t)+i;if(r){var a=Math.pow(t,r);i=Math.floor(Math.random()*a).toString(t)+i}var l=parseInt(i,t);return l!==1/0&&l>=Math.pow(2,e)?jt(e,t):i};jt.rack=function(e,t,n){var o=function(i){var a=0;do{if(a++>10){if(!n)throw new Error("too many ID collisions, use more bits");e+=n}var l=jt(e,t)}while(Object.hasOwnProperty.call(r,l));return r[l]=i,l},r=o.hats={};return o.get=function(i){return o.hats[i]},o.set=function(i,a){return o.hats[i]=a,o},o.bits=e||128,o.base=t||16,o};var Bt=F(fn.exports),W=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||Bt(),this.type=t.geometry.type};W.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},W.prototype.incomingCoords=function(e){this.setCoordinates(e)},W.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},W.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},W.prototype.setProperty=function(e,t){this.properties[e]=t},W.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:_.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},W.prototype.internal=function(e){var t={id:this.id,meta:$.FEATURE,"meta:type":this.type,active:J.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var n in this.properties)t["user_"+n]=this.properties[n];return{type:_.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ie=function(e,t){W.call(this,e,t)};(Ie.prototype=Object.create(W.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ie.prototype.updateCoordinate=function(e,t,n){this.coordinates=arguments.length===3?[t,n]:[e,t],this.changed()},Ie.prototype.getCoordinate=function(){return this.getCoordinates()};var de=function(e,t){W.call(this,e,t)};(de.prototype=Object.create(W.prototype)).isValid=function(){return this.coordinates.length>1},de.prototype.addCoordinate=function(e,t,n){this.changed();var o=parseInt(e,10);this.coordinates.splice(o,0,[t,n])},de.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},de.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},de.prototype.updateCoordinate=function(e,t,n){var o=parseInt(e,10);this.coordinates[o]=[t,n],this.changed()};var oe=function(e,t){W.call(this,e,t),this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};(oe.prototype=Object.create(W.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(e){return e.length>2})},oe.prototype.incomingCoords=function(e){this.coordinates=e.map(function(t){return t.slice(0,-1)}),this.changed()},oe.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},oe.prototype.addCoordinate=function(e,t,n){this.changed();var o=e.split(".").map(function(r){return parseInt(r,10)});this.coordinates[o[0]].splice(o[1],0,[t,n])},oe.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))},oe.prototype.getCoordinate=function(e){var t=e.split(".").map(function(o){return parseInt(o,10)}),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},oe.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},oe.prototype.updateCoordinate=function(e,t,n){this.changed();var o=e.split("."),r=parseInt(o[0],10),i=parseInt(o[1],10);this.coordinates[r]===void 0&&(this.coordinates[r]=[]),this.coordinates[r][i]=[t,n]};var ho={MultiPoint:Ie,MultiLineString:de,MultiPolygon:oe},ot=function(e,t,n,o,r){var i=n.split("."),a=parseInt(i[0],10),l=i[1]?i.slice(1).join("."):null;return e[a][t](l,o,r)},K=function(e,t){if(W.call(this,e,t),delete this.coordinates,this.model=ho[t.geometry.type],this.model===void 0)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function T(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(K.prototype=Object.create(W.prototype))._coordinatesToFeatures=function(e){var t=this,n=this.model.bind(this);return e.map(function(o){return new n(t.ctx,{id:Bt(),type:_.FEATURE,properties:{},geometry:{coordinates:o,type:t.type.replace("Multi","")}})})},K.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},K.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},K.prototype.getCoordinate=function(e){return ot(this.features,"getCoordinate",e)},K.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===_.POLYGON?e.getCoordinates():e.coordinates})))},K.prototype.updateCoordinate=function(e,t,n){ot(this.features,"updateCoordinate",e,t,n),this.changed()},K.prototype.addCoordinate=function(e,t,n){ot(this.features,"addCoordinate",e,t,n),this.changed()},K.prototype.removeCoordinate=function(e){ot(this.features,"removeCoordinate",e),this.changed()},K.prototype.getFeatures=function(){return this.features},T.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},T.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(n,o){return n[o.feature_id]===void 0&&(n[o.feature_id]=!0,t._ctx.store.get(o.feature_id).changed()),n},{})},T.prototype.getSelected=function(){return this._ctx.store.getSelected()},T.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},T.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},T.prototype.getFeature=function(e){return this._ctx.store.get(e)},T.prototype.select=function(e){return this._ctx.store.select(e)},T.prototype.deselect=function(e){return this._ctx.store.deselect(e)},T.prototype.deleteFeature=function(e,t){return t===void 0&&(t={}),this._ctx.store.delete(e,t)},T.prototype.addFeature=function(e){return this._ctx.store.add(e)},T.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},T.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},T.prototype.setActionableState=function(e){e===void 0&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},T.prototype.changeMode=function(e,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),this._ctx.events.changeMode(e,t,n)},T.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},T.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},T.prototype.featuresAt=function(e,t,n){if(n===void 0&&(n="click"),n!=="click"&&n!=="touch")throw new Error("invalid buffer type");return De[n](e,t,this._ctx)},T.prototype.newFeature=function(e){var t=e.geometry.type;return t===_.POINT?new Ie(this._ctx,e):t===_.LINE_STRING?new de(this._ctx,e):t===_.POLYGON?new oe(this._ctx,e):new K(this._ctx,e)},T.prototype.isInstanceOf=function(e,t){if(e===_.POINT)return t instanceof Ie;if(e===_.LINE_STRING)return t instanceof de;if(e===_.POLYGON)return t instanceof oe;if(e==="MultiFeature")return t instanceof K;throw new Error("Unknown feature class: "+e)},T.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},T.prototype.onSetup=function(){},T.prototype.onDrag=function(){},T.prototype.onClick=function(){},T.prototype.onMouseMove=function(){},T.prototype.onMouseDown=function(){},T.prototype.onMouseUp=function(){},T.prototype.onMouseOut=function(){},T.prototype.onKeyUp=function(){},T.prototype.onKeyDown=function(){},T.prototype.onTouchStart=function(){},T.prototype.onTouchMove=function(){},T.prototype.onTouchEnd=function(){},T.prototype.onTap=function(){},T.prototype.onStop=function(){},T.prototype.onTrash=function(){},T.prototype.onCombineFeature=function(){},T.prototype.onUncombineFeature=function(){},T.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var hn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},go=Object.keys(hn);function yo(e){var t=Object.keys(e);return function(n,o){o===void 0&&(o={});var r={},i=t.reduce(function(a,l){return a[l]=e[l],a},new T(n));return{start:function(){var a=this;r=i.onSetup(o),go.forEach(function(l){var d,h=hn[l],g=function(){return!1};e[h]&&(g=function(){return!0}),a.on(l,g,(d=h,function(p){return i[d](r,p)}))})},stop:function(){i.onStop(r)},trash:function(){i.onTrash(r)},combineFeatures:function(){i.onCombineFeatures(r)},uncombineFeatures:function(){i.onUncombineFeatures(r)},render:function(a,l){i.toDisplayFeatures(r,a,l)}}}}function Ye(e){return[].concat(e).filter(function(t){return t!==void 0})}function mo(){var e=this;if(!(e.ctx.map&&e.ctx.map.getSource(te.HOT)!==void 0))return d();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var n=[],o=[];e.isDirty?o=e.getAllIds():(n=e.getChangedIds().filter(function(h){return e.get(h)!==void 0}),o=e.sources.hot.filter(function(h){return h.properties.id&&n.indexOf(h.properties.id)===-1&&e.get(h.properties.id)!==void 0}).map(function(h){return h.properties.id})),e.sources.hot=[];var r=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(h){var g=h.properties.id||h.properties.parent;return n.indexOf(g)===-1});var i=r!==e.sources.cold.length||o.length>0;function a(h,g){var p=e.get(h).internal(t);e.ctx.events.currentModeRender(p,function(b){e.sources[g].push(b)})}if(n.forEach(function(h){return a(h,"hot")}),o.forEach(function(h){return a(h,"cold")}),i&&e.ctx.map.getSource(te.COLD).setData({type:_.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(te.HOT).setData({type:_.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(ee.SELECTION_CHANGE,{features:e.getSelected().map(function(h){return h.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(h){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:h.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var l=e._deletedFeaturesToEmit.map(function(h){return h.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(ee.DELETE,{features:l})}function d(){e.isDirty=!1,e.clearChangedIds()}d(),e.ctx.map.fire(ee.RENDER,{})}function w(e){var t,n=this;this._features={},this._featureIds=new ne,this._selectedFeatureIds=new ne,this._selectedCoordinates=[],this._changedFeatureIds=new ne,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame(function(){t=null,mo.call(n)}))},this.isDirty=!1}function gn(e,t){var n=e._selectedCoordinates.filter(function(o){return e._selectedFeatureIds.has(o.feature_id)});e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}w.prototype.createRenderBatch=function(){var e=this,t=this.render,n=0;return this.render=function(){n++},function(){e.render=t,n>0&&e.render()}},w.prototype.setDirty=function(){return this.isDirty=!0,this},w.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},w.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},w.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},w.prototype.getAllIds=function(){return this._featureIds.values()},w.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},w.prototype.delete=function(e,t){var n=this;return t===void 0&&(t={}),Ye(e).forEach(function(o){n._featureIds.has(o)&&(n._featureIds.delete(o),n._selectedFeatureIds.delete(o),t.silent||n._deletedFeaturesToEmit.indexOf(n._features[o])===-1&&n._deletedFeaturesToEmit.push(n._features[o]),delete n._features[o],n.isDirty=!0)}),gn(this,t),this},w.prototype.get=function(e){return this._features[e]},w.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},w.prototype.select=function(e,t){var n=this;return t===void 0&&(t={}),Ye(e).forEach(function(o){n._selectedFeatureIds.has(o)||(n._selectedFeatureIds.add(o),n._changedFeatureIds.add(o),t.silent||(n._emitSelectionChange=!0))}),this},w.prototype.deselect=function(e,t){var n=this;return t===void 0&&(t={}),Ye(e).forEach(function(o){n._selectedFeatureIds.has(o)&&(n._selectedFeatureIds.delete(o),n._changedFeatureIds.add(o),t.silent||(n._emitSelectionChange=!0))}),gn(this,t),this},w.prototype.clearSelected=function(e){return e===void 0&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},w.prototype.setSelected=function(e,t){var n=this;return t===void 0&&(t={}),e=Ye(e),this.deselect(this._selectedFeatureIds.values().filter(function(o){return e.indexOf(o)===-1}),{silent:t.silent}),this.select(e.filter(function(o){return!n._selectedFeatureIds.has(o)}),{silent:t.silent}),this},w.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},w.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},w.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},w.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},w.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},w.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},w.prototype.setFeatureProperty=function(e,t,n){this.get(e).setProperty(t,n),this.featureChanged(e)},w.prototype.storeMapConfig=function(){var e=this;un.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},w.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},w.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]===void 0||this._mapInitialConfig[e]};var vo=function(){for(var e=arguments,t={},n=0;n<arguments.length;n++){var o=e[n];for(var r in o)_o.call(o,r)&&(t[r]=o[r])}return t},_o=Object.prototype.hasOwnProperty,ve=F(vo),bo=["mode","feature","mouse"];function Eo(e){var t=null,n=null,o={onRemove:function(){return e.map.off("load",o.connect),clearInterval(n),o.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect:function(){e.map.off("load",o.connect),clearInterval(n),o.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd:function(r){var i=r.fire;return r.fire=function(a,l){var d=arguments;return i.length===1&&arguments.length!==1&&(d=[ve({},{type:a},l)]),i.apply(r,d)},e.map=r,e.events=function(a){var l=Object.keys(a.options.modes).reduce(function(c,y){return c[y]=yo(a.options.modes[y]),c},{}),d={},h={},g={},p=null,b=null;g.drag=function(c,y){y({point:c.point,time:new Date().getTime()})?(a.ui.queueMapClasses({mouse:D.DRAG}),b.drag(c)):c.originalEvent.stopPropagation()},g.mousedrag=function(c){g.drag(c,function(y){return!Ut(d,y)})},g.touchdrag=function(c){g.drag(c,function(y){return!kt(h,y)})},g.mousemove=function(c){if((c.originalEvent.buttons!==void 0?c.originalEvent.buttons:c.originalEvent.which)===1)return g.mousedrag(c);var y=nt(c,a);c.featureTarget=y,b.mousemove(c)},g.mousedown=function(c){d={time:new Date().getTime(),point:c.point};var y=nt(c,a);c.featureTarget=y,b.mousedown(c)},g.mouseup=function(c){var y=nt(c,a);c.featureTarget=y,Ut(d,{point:c.point,time:new Date().getTime()})?b.click(c):b.mouseup(c)},g.mouseout=function(c){b.mouseout(c)},g.touchstart=function(c){if(a.options.touchEnabled){h={time:new Date().getTime(),point:c.point};var y=De.touch(c,null,a)[0];c.featureTarget=y,b.touchstart(c)}},g.touchmove=function(c){if(a.options.touchEnabled)return b.touchmove(c),g.touchdrag(c)},g.touchend=function(c){if(c.originalEvent.preventDefault(),a.options.touchEnabled){var y=De.touch(c,null,a)[0];c.featureTarget=y,kt(h,{time:new Date().getTime(),point:c.point})?b.tap(c):b.touchend(c)}};var R=function(c){return!(c===8||c===46||c>=48&&c<=57)};function E(c,y,M){M===void 0&&(M={}),b.stop();var Y=l[c];if(Y===void 0)throw new Error(c+" is not valid");p=c;var j=Y(a,y);b=S(j,a),M.silent||a.map.fire(ee.MODE_CHANGE,{mode:c}),a.store.setDirty(),a.store.render()}g.keydown=function(c){(c.srcElement||c.target).classList.contains("mapboxgl-canvas")&&(c.keyCode!==8&&c.keyCode!==46||!a.options.controls.trash?R(c.keyCode)?b.keydown(c):c.keyCode===49&&a.options.controls.point?E(C.DRAW_POINT):c.keyCode===50&&a.options.controls.line_string?E(C.DRAW_LINE_STRING):c.keyCode===51&&a.options.controls.polygon&&E(C.DRAW_POLYGON):(c.preventDefault(),b.trash()))},g.keyup=function(c){R(c.keyCode)&&b.keyup(c)},g.zoomend=function(){a.store.changeZoom()},g.data=function(c){if(c.dataType==="style"){var y=a.setup,M=a.map,Y=a.options,j=a.store;Y.styles.some(function(Wt){return M.getLayer(Wt.id)})||(y.addLayers(),j.setDirty(),j.render())}};var k={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){p=a.options.defaultMode,b=S(l[p](a),a)},changeMode:E,actionable:function(c){var y=!1;Object.keys(c).forEach(function(M){if(k[M]===void 0)throw new Error("Invalid action type");k[M]!==c[M]&&(y=!0),k[M]=c[M]}),y&&a.map.fire(ee.ACTIONABLE,{actions:k})},currentModeName:function(){return p},currentModeRender:function(c,y){return b.render(c,y)},fire:function(c,y){g[c]&&g[c](y)},addEventListeners:function(){a.map.on("mousemove",g.mousemove),a.map.on("mousedown",g.mousedown),a.map.on("mouseup",g.mouseup),a.map.on("data",g.data),a.map.on("touchmove",g.touchmove),a.map.on("touchstart",g.touchstart),a.map.on("touchend",g.touchend),a.container.addEventListener("mouseout",g.mouseout),a.options.keybindings&&(a.container.addEventListener("keydown",g.keydown),a.container.addEventListener("keyup",g.keyup))},removeEventListeners:function(){a.map.off("mousemove",g.mousemove),a.map.off("mousedown",g.mousedown),a.map.off("mouseup",g.mouseup),a.map.off("data",g.data),a.map.off("touchmove",g.touchmove),a.map.off("touchstart",g.touchstart),a.map.off("touchend",g.touchend),a.container.removeEventListener("mouseout",g.mouseout),a.options.keybindings&&(a.container.removeEventListener("keydown",g.keydown),a.container.removeEventListener("keyup",g.keyup))},trash:function(c){b.trash(c)},combineFeatures:function(){b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures()},getMode:function(){return p}}}(e),e.ui=function(a){var l={},d=null,h={mode:null,feature:null,mouse:null},g={mode:null,feature:null,mouse:null};function p(c){g=ve(g,c)}function b(){var c,y;if(a.container){var M=[],Y=[];bo.forEach(function(j){g[j]!==h[j]&&(M.push(j+"-"+h[j]),g[j]!==null&&Y.push(j+"-"+g[j]))}),M.length>0&&(c=a.container.classList).remove.apply(c,M),Y.length>0&&(y=a.container.classList).add.apply(y,Y),h=ve(h,g)}}function R(c,y){y===void 0&&(y={});var M=document.createElement("button");return M.className=Q.CONTROL_BUTTON+" "+y.className,M.setAttribute("title",y.title),y.container.appendChild(M),M.addEventListener("click",function(Y){if(Y.preventDefault(),Y.stopPropagation(),Y.target===d)return E(),void y.onDeactivate();k(c),y.onActivate()},!0),M}function E(){d&&(d.classList.remove(Q.ACTIVE_BUTTON),d=null)}function k(c){E();var y=l[c];y&&y&&c!=="trash"&&(y.classList.add(Q.ACTIVE_BUTTON),d=y)}return{setActiveButton:k,queueMapClasses:p,updateMapClasses:b,clearMapClasses:function(){p({mode:null,feature:null,mouse:null}),b()},addButtons:function(){var c=a.options.controls,y=document.createElement("div");return y.className=Q.CONTROL_GROUP+" "+Q.CONTROL_BASE,c&&(c[X.LINE]&&(l[X.LINE]=R(X.LINE,{container:y,className:Q.CONTROL_BUTTON_LINE,title:"LineString tool "+(a.options.keybindings?"(l)":""),onActivate:function(){return a.events.changeMode(C.DRAW_LINE_STRING)},onDeactivate:function(){return a.events.trash()}})),c[X.POLYGON]&&(l[X.POLYGON]=R(X.POLYGON,{container:y,className:Q.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(a.options.keybindings?"(p)":""),onActivate:function(){return a.events.changeMode(C.DRAW_POLYGON)},onDeactivate:function(){return a.events.trash()}})),c[X.POINT]&&(l[X.POINT]=R(X.POINT,{container:y,className:Q.CONTROL_BUTTON_POINT,title:"Marker tool "+(a.options.keybindings?"(m)":""),onActivate:function(){return a.events.changeMode(C.DRAW_POINT)},onDeactivate:function(){return a.events.trash()}})),c.trash&&(l.trash=R("trash",{container:y,className:Q.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){a.events.trash()}})),c.combine_features&&(l.combine_features=R("combineFeatures",{container:y,className:Q.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){a.events.combineFeatures()}})),c.uncombine_features&&(l.uncombine_features=R("uncombineFeatures",{container:y,className:Q.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){a.events.uncombineFeatures()}}))),y},removeButtons:function(){Object.keys(l).forEach(function(c){var y=l[c];y.parentNode&&y.parentNode.removeChild(y),delete l[c]})}}}(e),e.container=r.getContainer(),e.store=new w(e),t=e.ui.addButtons(),e.options.boxSelect&&(e.boxZoomInitial=r.boxZoom.isEnabled(),r.boxZoom.disable(),r.dragPan.disable(),r.dragPan.enable()),r.loaded()?o.connect():(r.on("load",o.connect),n=setInterval(function(){r.loaded()&&o.connect()},16)),e.events.start(),t},addLayers:function(){e.map.addSource(te.COLD,{data:{type:_.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(te.HOT,{data:{type:_.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(function(r){e.map.addLayer(r)}),e.store.setDirty(!0),e.store.render()},removeLayers:function(){e.options.styles.forEach(function(r){e.map.getLayer(r.id)&&e.map.removeLayer(r.id)}),e.map.getSource(te.COLD)&&e.map.removeSource(te.COLD),e.map.getSource(te.HOT)&&e.map.removeSource(te.HOT)}};return e.setup=o,o}var yn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function rt(e){return function(t){var n=t.featureTarget;return!!n&&!!n.properties&&n.properties.meta===e}}function mn(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&e.originalEvent.button===0}function Oe(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===J.ACTIVE&&e.featureTarget.properties.meta===$.FEATURE}function Vt(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===J.INACTIVE&&e.featureTarget.properties.meta===$.FEATURE}function it(e){return e.featureTarget===void 0}function Gt(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===$.FEATURE}function Ze(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===$.VERTEX}function at(e){return!!e.originalEvent&&e.originalEvent.shiftKey===!0}function st(e){return e.keyCode===27}function ut(e){return e.keyCode===13}var To=Object.freeze({__proto__:null,isOfMetaType:rt,isShiftMousedown:mn,isActiveFeature:Oe,isInactiveFeature:Vt,noTarget:it,isFeature:Gt,isVertex:Ze,isShiftDown:at,isEscapeKey:st,isEnterKey:ut,isTrue:function(){return!0}}),Co=Re;function Re(e,t){this.x=e,this.y=t}Re.prototype={clone:function(){return new Re(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),o=t*this.x-n*this.y,r=n*this.x+t*this.y;return this.x=o,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),o=Math.sin(e),r=t.x+n*(this.x-t.x)-o*(this.y-t.y),i=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=r,this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Re.convert=function(e){return e instanceof Re?e:Array.isArray(e)?new Re(e[0],e[1]):e};var Io=F(Co);function zt(e,t){var n=t.getBoundingClientRect();return new Io(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))}function Ue(e,t,n,o){return{type:_.FEATURE,properties:{meta:$.VERTEX,parent:e,coord_path:n,active:o?J.ACTIVE:J.INACTIVE},geometry:{type:_.POINT,coordinates:t}}}function vn(e,t,n){var o=t.geometry.coordinates,r=n.geometry.coordinates;if(o[1]>85||o[1]<Dt||r[1]>85||r[1]<Dt)return null;var i={lng:(o[0]+r[0])/2,lat:(o[1]+r[1])/2};return{type:_.FEATURE,properties:{meta:$.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:_.POINT,coordinates:[i.lng,i.lat]}}}function ct(e,t,n){t===void 0&&(t={}),n===void 0&&(n=null);var o,r=e.geometry,i=r.type,a=r.coordinates,l=e.properties&&e.properties.id,d=[];function h(p,b){var R="",E=null;p.forEach(function(k,c){var y=b!=null?b+"."+c:String(c),M=Ue(l,k,y,g(y));if(t.midpoints&&E){var Y=vn(l,E,M);Y&&d.push(Y)}E=M;var j=JSON.stringify(k);R!==j&&d.push(M),c===0&&(R=j)})}function g(p){return!!t.selectedPaths&&t.selectedPaths.indexOf(p)!==-1}return i===_.POINT?d.push(Ue(l,a,n,g(n))):i===_.POLYGON?a.forEach(function(p,b){h(p,n!==null?n+"."+b:String(b))}):i===_.LINE_STRING?h(a,n):i.indexOf(_.MULTI_PREFIX)===0&&(o=i.replace(_.MULTI_PREFIX,""),a.forEach(function(p,b){var R={type:_.FEATURE,properties:e.properties,geometry:{type:o,coordinates:p}};d=d.concat(ct(R,t,b))})),d}var ae={enable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},lt={exports:{}},_n=function(e){if(!e||!e.type)return null;var t=Oo[e.type];if(!t)return null;if(t==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]};if(t==="feature")return{type:"FeatureCollection",features:[e]};if(t==="featurecollection")return e},Oo={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},So=F(_n),xo=Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(n,o){return n.concat(e(o))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(n){var o={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:n};return t.id!==void 0&&(o.id=t.id),o}):[t];case"MultiPoint":return t.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return t.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return t.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return t.geometries.map(e).reduce(function(n,o){return n.concat(o)},[]);case"Point":case"Polygon":case"LineString":return[t]}}}),Mo=_n,dt=x(xo),Lo=function(e){return function t(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(o,r){return Array.isArray(r)&&Array.isArray(r[0])?o.concat(t(r)):(o.push(r),o)},[])}(e)};dt instanceof Function||(dt=dt.default);var bn={exports:{}},No=bn.exports=function(e){return new re(e)};function re(e){this.value=e}function En(e,t,n){var o=[],r=[],i=!0;return function a(l){var d=n?Tn(l):l,h={},g=!0,p={node:d,node_:l,path:[].concat(o),parent:r[r.length-1],parents:r,key:o.slice(-1)[0],isRoot:o.length===0,level:o.length,circular:null,update:function(E,k){p.isRoot||(p.parent.node[p.key]=E),p.node=E,k&&(g=!1)},delete:function(E){delete p.parent.node[p.key],E&&(g=!1)},remove:function(E){Cn(p.parent.node)?p.parent.node.splice(p.key,1):delete p.parent.node[p.key],E&&(g=!1)},keys:null,before:function(E){h.before=E},after:function(E){h.after=E},pre:function(E){h.pre=E},post:function(E){h.post=E},stop:function(){i=!1},block:function(){g=!1}};if(!i)return p;function b(){if(typeof p.node=="object"&&p.node!==null){p.keys&&p.node_===p.node||(p.keys=pt(p.node)),p.isLeaf=p.keys.length==0;for(var E=0;E<r.length;E++)if(r[E].node_===l){p.circular=r[E];break}}else p.isLeaf=!0,p.keys=null;p.notLeaf=!p.isLeaf,p.notRoot=!p.isRoot}b();var R=t.call(p,p.node);return R!==void 0&&p.update&&p.update(R),h.before&&h.before.call(p,p.node),g&&(typeof p.node!="object"||p.node===null||p.circular||(r.push(p),b(),ft(p.keys,function(E,k){o.push(E),h.pre&&h.pre.call(p,p.node[E],E);var c=a(p.node[E]);n&&ht.call(p.node,E)&&(p.node[E]=c.node),c.isLast=k==p.keys.length-1,c.isFirst=k==0,h.post&&h.post.call(p,c),o.pop()}),r.pop()),h.after&&h.after.call(p,p.node)),p}(e).node}function Tn(e){if(typeof e=="object"&&e!==null){var t;if(Cn(e))t=[];else if(ke(e)==="[object Date]")t=new Date(e.getTime?e.getTime():e);else if(function(r){return ke(r)==="[object RegExp]"}(e))t=new RegExp(e);else if(function(r){return ke(r)==="[object Error]"}(e))t={message:e.message};else if(function(r){return ke(r)==="[object Boolean]"}(e))t=new Boolean(e);else if(function(r){return ke(r)==="[object Number]"}(e))t=new Number(e);else if(function(r){return ke(r)==="[object String]"}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var n=e.constructor&&e.constructor.prototype||e.__proto__||{},o=function(){};o.prototype=n,t=new o}return ft(pt(e),function(r){t[r]=e[r]}),t}return e}re.prototype.get=function(e){for(var t=this.value,n=0;n<e.length;n++){var o=e[n];if(!t||!ht.call(t,o)){t=void 0;break}t=t[o]}return t},re.prototype.has=function(e){for(var t=this.value,n=0;n<e.length;n++){var o=e[n];if(!t||!ht.call(t,o))return!1;t=t[o]}return!0},re.prototype.set=function(e,t){for(var n=this.value,o=0;o<e.length-1;o++){var r=e[o];ht.call(n,r)||(n[r]={}),n=n[r]}return n[e[o]]=t,t},re.prototype.map=function(e){return En(this.value,e,!0)},re.prototype.forEach=function(e){return this.value=En(this.value,e,!1),this.value},re.prototype.reduce=function(e,t){var n=arguments.length===1,o=n?this.value:t;return this.forEach(function(r){this.isRoot&&n||(o=e.call(this,o,r))}),o},re.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},re.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},re.prototype.clone=function(){var e=[],t=[];return function n(o){for(var r=0;r<e.length;r++)if(e[r]===o)return t[r];if(typeof o=="object"&&o!==null){var i=Tn(o);return e.push(o),t.push(i),ft(pt(o),function(a){i[a]=n(o[a])}),e.pop(),t.pop(),i}return o}(this.value)};var pt=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};function ke(e){return Object.prototype.toString.call(e)}var Cn=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},ft=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n,e)};ft(pt(re.prototype),function(e){No[e]=function(t){var n=[].slice.call(arguments,1),o=new re(t);return o[e].apply(o,n)}});var ht=Object.hasOwnProperty||function(e,t){return t in e},Fo=bn.exports,wo=H;function H(e){if(!(this instanceof H))return new H(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}H.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},H.prototype.equals=function(e){var t;return t=e instanceof H?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},H.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},H.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof H?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},H.prototype.bbox=function(){return this._valid?this._bbox:null},H.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],n=e[1];return this._bbox[0]<=t&&this._bbox[1]<=n&&this._bbox[2]>=t&&this._bbox[3]>=n},H.prototype.intersect=function(e){return this._valid?(t=e instanceof H?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},H.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},H.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Po=function(e){if(!e)return[];var t=dt(Mo(e)),n=[];return t.features.forEach(function(o){o.geometry&&(n=n.concat(Lo(o.geometry.coordinates)))}),n},Ao=Fo,Do=wo,In={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ro=Object.keys(In);function Jt(e){for(var t=Do(),n=Po(e),o=0;o<n.length;o++)t.include(n[o]);return t}lt.exports=function(e){return Jt(e).bbox()},lt.exports.polygon=function(e){return Jt(e).polygon()},lt.exports.bboxify=function(e){return Ao(e).map(function(t){t&&Ro.some(function(n){return!!t[n]&&In[n].indexOf(t.type)!==-1})&&(t.bbox=Jt(t).bbox(),this.update(t))})};var Uo=F(lt.exports),gt=-90;function Yt(e,t){var n=gt,o=90,r=gt,i=90,a=270,l=-270;e.forEach(function(h){var g=Uo(h),p=g[1],b=g[3],R=g[0],E=g[2];p>n&&(n=p),b<o&&(o=b),b>r&&(r=b),p<i&&(i=p),R<a&&(a=R),E>l&&(l=E)});var d=t;return n+d.lat>85&&(d.lat=85-n),r+d.lat>90&&(d.lat=90-r),o+d.lat<-85&&(d.lat=-85-o),i+d.lat<gt&&(d.lat=gt-i),a+d.lng<=-270&&(d.lng+=360*Math.ceil(Math.abs(d.lng)/360)),l+d.lng>=270&&(d.lng-=360*Math.ceil(Math.abs(d.lng)/360)),d}function Zt(e,t){var n=Yt(e.map(function(o){return o.toGeoJSON()}),t);e.forEach(function(o){var r,i=o.getCoordinates(),a=function(d){var h={lng:d[0]+n.lng,lat:d[1]+n.lat};return[h.lng,h.lat]},l=function(d){return d.map(function(h){return a(h)})};o.type===_.POINT?r=a(i):o.type===_.LINE_STRING||o.type===_.MULTI_POINT?r=i.map(a):o.type===_.POLYGON||o.type===_.MULTI_LINE_STRING?r=i.map(l):o.type===_.MULTI_POLYGON&&(r=i.map(function(d){return d.map(function(h){return l(h)})})),o.incomingCoords(r)})}var V={onSetup:function(e){var t=this,n={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(n.initiallySelectedFeatureIds.filter(function(o){return t.getFeature(o)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),n},fireUpdate:function(){this.map.fire(ee.UPDATE,{action:At.MOVE,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,t=this.getSelected(),n=t.filter(function(l){return e.isInstanceOf("MultiFeature",l)}),o=!1;if(t.length>1){o=!0;var r=t[0].type.replace("Multi","");t.forEach(function(l){l.type.replace("Multi","")!==r&&(o=!1)})}var i=n.length>0,a=t.length>0;this.setActionableState({combineFeatures:o,uncombineFeatures:i,trash:a})},getUniqueIds:function(e){return e.length?e.map(function(t){return t.properties.id}).filter(function(t){return t!==void 0}).reduce(function(t,n){return t.add(n),t},new ne).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){ae.enable(this)},onMouseMove:function(e,t){return Gt(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};V.onTap=V.onClick=function(e,t){return it(t)?this.clickAnywhere(e,t):rt($.VERTEX)(t)?this.clickOnVertex(e,t):Gt(t)?this.clickOnFeature(e,t):void 0},V.clickAnywhere=function(e){var t=this,n=this.getSelectedIds();n.length&&(this.clearSelectedFeatures(),n.forEach(function(o){return t.doRender(o)})),ae.enable(this),this.stopExtendedInteractions(e)},V.clickOnVertex=function(e,t){this.changeMode(C.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:D.MOVE})},V.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},V.clickOnFeature=function(e,t){var n=this;ae.disable(this),this.stopExtendedInteractions(e);var o=at(t),r=this.getSelectedIds(),i=t.featureTarget.properties.id,a=this.isSelected(i);if(!o&&a&&this.getFeature(i).type!==_.POINT)return this.changeMode(C.DIRECT_SELECT,{featureId:i});a&&o?(this.deselect(i),this.updateUIClasses({mouse:D.POINTER}),r.length===1&&ae.enable(this)):!a&&o?(this.select(i),this.updateUIClasses({mouse:D.MOVE})):a||o||(r.forEach(function(l){return n.doRender(l)}),this.setSelected(i),this.updateUIClasses({mouse:D.MOVE})),this.doRender(i)},V.onMouseDown=function(e,t){return Oe(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&mn(t)?this.startBoxSelect(e,t):void 0},V.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=zt(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},V.onTouchStart=function(e,t){if(Oe(t))return this.startOnActiveFeature(e,t)},V.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},V.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:D.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(Q.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var n=zt(t.originalEvent,this.map.getContainer()),o=Math.min(e.boxSelectStartLocation.x,n.x),r=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),a=Math.max(e.boxSelectStartLocation.y,n.y),l="translate("+o+"px, "+i+"px)";e.boxSelectElement.style.transform=l,e.boxSelectElement.style.WebkitTransform=l,e.boxSelectElement.style.width=r-o+"px",e.boxSelectElement.style.height=a-i+"px"},V.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Zt(this.getSelected(),n),e.dragMoveLocation=t.lngLat},V.onTouchEnd=V.onMouseUp=function(e,t){var n=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var o=[e.boxSelectStartLocation,zt(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,o,"click"),i=this.getUniqueIds(r).filter(function(a){return!n.isSelected(a)});i.length&&(this.select(i),i.forEach(function(a){return n.doRender(a)}),this.updateUIClasses({mouse:D.MOVE}))}this.stopExtendedInteractions(e)},V.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?J.ACTIVE:J.INACTIVE,n(t),this.fireActionable(),t.properties.active===J.ACTIVE&&t.geometry.type!==_.POINT&&ct(t).forEach(n)},V.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},V.onCombineFeatures=function(){var e=this.getSelected();if(!(e.length===0||e.length<2)){for(var t=[],n=[],o=e[0].type.replace("Multi",""),r=0;r<e.length;r++){var i=e[r];if(i.type.replace("Multi","")!==o)return;i.type.includes("Multi")?i.getCoordinates().forEach(function(l){t.push(l)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){var a=this.newFeature({type:_.FEATURE,properties:n[0].properties,geometry:{type:"Multi"+o,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(ee.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:n})}this.fireActionable()}},V.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(t.length!==0){for(var n=[],o=[],r=function(a){var l=t[a];e.isInstanceOf("MultiFeature",l)&&(l.getFeatures().forEach(function(d){e.addFeature(d),d.properties=l.properties,n.push(d.toGeoJSON()),e.select([d.id])}),e.deleteFeature(l.id,{silent:!0}),o.push(l.toGeoJSON()))},i=0;i<t.length;i++)r(i);n.length>1&&this.map.fire(ee.UNCOMBINE_FEATURES,{createdFeatures:n,deletedFeatures:o}),this.fireActionable()}};var On=rt($.VERTEX),Sn=rt($.MIDPOINT),_e={fireUpdate:function(){this.map.fire(ee.UPDATE,{action:At.CHANGE_COORDINATES,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties,o=e.selectedCoordPaths.indexOf(n.coord_path);at(t)||o!==-1?at(t)&&o===-1&&e.selectedCoordPaths.push(n.coord_path):e.selectedCoordPaths=[n.coord_path];var r=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(r)},onMidpoint:function(e,t){this.startDragging(e,t);var n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(n){return{feature_id:e,coord_path:n}})},onFeature:function(e,t){e.selectedCoordPaths.length===0?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,n){Zt(this.getSelected(),n),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,n){for(var o=e.selectedCoordPaths.map(function(l){return e.feature.getCoordinate(l)}),r=Yt(o.map(function(l){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:l}}}),n),i=0;i<o.length;i++){var a=o[i];e.feature.updateCoordinate(e.selectedCoordPaths[i],a[0]+r.lng,a[1]+r.lat)}},clickNoTarget:function(){this.changeMode(C.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(C.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===_.POINT)throw new TypeError("direct_select mode doesn't handle point features");var o={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,o.selectedCoordPaths)),this.setSelected(t),ae.disable(this),this.setActionableState({trash:!0}),o},onStop:function(){ae.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,n){e.featureId===t.properties.id?(t.properties.active=J.ACTIVE,n(t),ct(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=J.INACTIVE,n(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(t,n){return n.localeCompare(t,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(C.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var n=Oe(t),o=On(t),r=Sn(t),i=e.selectedCoordPaths.length===0;return n&&i||o&&!i?this.updateUIClasses({mouse:D.MOVE}):this.updateUIClasses({mouse:D.NONE}),(o||n||r)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};_e.onTouchStart=_e.onMouseDown=function(e,t){return On(t)?this.onVertex(e,t):Oe(t)?this.onFeature(e,t):Sn(t)?this.onMidpoint(e,t):void 0},_e.onDrag=function(e,t){if(e.canDragMove===!0){e.dragMoving=!0,t.originalEvent.stopPropagation();var n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat}},_e.onClick=function(e,t){return it(t)?this.clickNoTarget(e,t):Oe(t)?this.clickActiveFeature(e,t):Vt(t)?this.clickInactive(e,t):void this.stopDragging(e)},_e.onTap=function(e,t){return it(t)?this.clickNoTarget(e,t):Oe(t)?this.clickActiveFeature(e,t):Vt(t)?this.clickInactive(e,t):void 0},_e.onTouchEnd=_e.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var ue={};function yt(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}ue.onSetup=function(){var e=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:D.ADD}),this.activateUIButton(X.POINT),this.setActionableState({trash:!0}),{point:e}},ue.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT)},ue.onTap=ue.onClick=function(e,t){this.updateUIClasses({mouse:D.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(ee.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.point.id]})},ue.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},ue.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.point.id;if(t.properties.active=o?J.ACTIVE:J.INACTIVE,!o)return n(t)},ue.onTrash=ue.stopDrawingAndRemove,ue.onKeyUp=function(e,t){if(st(t)||ut(t))return this.stopDrawingAndRemove(e,t)};var Se={onSetup:function(){var e=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),ae.disable(this),this.updateUIClasses({mouse:D.ADD}),this.activateUIButton(X.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&yt(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:D.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ze(t)&&this.updateUIClasses({mouse:D.POINTER})}};Se.onTap=Se.onClick=function(e,t){return Ze(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},Se.onKeyUp=function(e,t){st(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT)):ut(t)&&this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},Se.onStop=function(e){this.updateUIClasses({mouse:D.NONE}),ae.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(ee.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT,{},{silent:!0})))},Se.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.polygon.id;if(t.properties.active=o?J.ACTIVE:J.INACTIVE,!o)return n(t);if(t.geometry.coordinates.length!==0){var r=t.geometry.coordinates[0].length;if(!(r<3)){if(t.properties.meta=$.FEATURE,n(Ue(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),r>3){var i=t.geometry.coordinates[0].length-3;n(Ue(e.polygon.id,t.geometry.coordinates[0][i],"0."+i,!1))}if(r<=4){var a=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:_.FEATURE,properties:t.properties,geometry:{coordinates:a,type:_.LINE_STRING}}),r===3)return}return n(t)}}},Se.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT)};var xe={onSetup:function(e){var t,n,o=(e=e||{}).featureId,r="forward";if(o){if(!(t=this.getFeature(o)))throw new Error("Could not find a feature with the provided featureId");var i=e.from;if(i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=t.coordinates.length-1;if(t.coordinates[a][0]===i[0]&&t.coordinates[a][1]===i[1])n=a+1,t.addCoordinate.apply(t,[n].concat(t.coordinates[a]));else{if(t.coordinates[0][0]!==i[0]||t.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");r="backwards",n=0,t.addCoordinate.apply(t,[n].concat(t.coordinates[0]))}}else t=this.newFeature({type:_.FEATURE,properties:{},geometry:{type:_.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(t);return this.clearSelectedFeatures(),ae.disable(this),this.updateUIClasses({mouse:D.ADD}),this.activateUIButton(X.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:n,direction:r}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&yt(t,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&yt(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:D.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ze(t)&&this.updateUIClasses({mouse:D.POINTER})}};xe.onTap=xe.onClick=function(e,t){if(Ze(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},xe.onKeyUp=function(e,t){ut(t)?this.changeMode(C.SIMPLE_SELECT,{featureIds:[e.line.id]}):st(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT))},xe.onStop=function(e){ae.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(ee.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT,{},{silent:!0})))},xe.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(C.SIMPLE_SELECT)},xe.toDisplayFeatures=function(e,t,n){var o=t.properties.id===e.line.id;if(t.properties.active=o?J.ACTIVE:J.INACTIVE,!o)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=$.FEATURE,n(Ue(e.line.id,t.geometry.coordinates[e.direction==="forward"?t.geometry.coordinates.length-2:1],""+(e.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),n(t))};var xn={simple_select:V,direct_select:_e,draw_point:ue,draw_polygon:Se,draw_line_string:xe},ko={defaultMode:C.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:yn,modes:xn,controls:{},userProperties:!1},jo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Bo={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Mn(e,t){return e.map(function(n){return n.source?n:ve(n,{id:n.id+"."+t,source:t==="hot"?te.HOT:te.COLD})})}var $t={exports:{}};(function(e,t){var n="__lodash_hash_undefined__",o=9007199254740991,r="[object Arguments]",i="[object Array]",a="[object Boolean]",l="[object Date]",d="[object Error]",h="[object Function]",g="[object Map]",p="[object Number]",b="[object Object]",R="[object Promise]",E="[object RegExp]",k="[object Set]",c="[object String]",y="[object Symbol]",M="[object WeakMap]",Y="[object ArrayBuffer]",j="[object DataView]",Wt=/^\[object .+?Constructor\]$/,Jo=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[r]=P[i]=P[Y]=P[a]=P[j]=P[l]=P[d]=P[h]=P[g]=P[p]=P[b]=P[E]=P[k]=P[c]=P[M]=!1;var Fn=typeof Qe=="object"&&Qe&&Qe.Object===Object&&Qe,Yo=typeof self=="object"&&self&&self.Object===Object&&self,pe=Fn||Yo||Function("return this")(),wn=t&&!t.nodeType&&t,Pn=wn&&e&&!e.nodeType&&e,An=Pn&&Pn.exports===wn,Ht=An&&Fn.process,Dn=function(){try{return Ht&&Ht.binding&&Ht.binding("util")}catch{}}(),Rn=Dn&&Dn.isTypedArray;function Zo(s,u){for(var f=-1,v=s==null?0:s.length;++f<v;)if(u(s[f],f,s))return!0;return!1}function $o(s){var u=-1,f=Array(s.size);return s.forEach(function(v,A){f[++u]=[A,v]}),f}function Wo(s){var u=-1,f=Array(s.size);return s.forEach(function(v){f[++u]=v}),f}var Un,kn,jn,Ho=Array.prototype,qo=Function.prototype,vt=Object.prototype,qt=pe["__core-js_shared__"],Bn=qo.toString,ce=vt.hasOwnProperty,Vn=(Un=/[^.]+$/.exec(qt&&qt.keys&&qt.keys.IE_PROTO||""))?"Symbol(src)_1."+Un:"",Gn=vt.toString,Xo=RegExp("^"+Bn.call(ce).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zn=An?pe.Buffer:void 0,_t=pe.Symbol,Jn=pe.Uint8Array,Yn=vt.propertyIsEnumerable,Ko=Ho.splice,Me=_t?_t.toStringTag:void 0,Zn=Object.getOwnPropertySymbols,Qo=zn?zn.isBuffer:void 0,er=(kn=Object.keys,jn=Object,function(s){return kn(jn(s))}),Xt=je(pe,"DataView"),$e=je(pe,"Map"),Kt=je(pe,"Promise"),Qt=je(pe,"Set"),en=je(pe,"WeakMap"),We=je(Object,"create"),tr=Fe(Xt),nr=Fe($e),or=Fe(Kt),rr=Fe(Qt),ir=Fe(en),$n=_t?_t.prototype:void 0,tn=$n?$n.valueOf:void 0;function Le(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function fe(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function Ne(s){var u=-1,f=s==null?0:s.length;for(this.clear();++u<f;){var v=s[u];this.set(v[0],v[1])}}function bt(s){var u=-1,f=s==null?0:s.length;for(this.__data__=new Ne;++u<f;)this.add(s[u])}function be(s){var u=this.__data__=new fe(s);this.size=u.size}function ar(s,u){var f=Ct(s),v=!f&&dr(s),A=!f&&!v&&nn(s),I=!f&&!v&&!A&&no(s),U=f||v||A||I,B=U?function(z,le){for(var he=-1,q=Array(z);++he<z;)q[he]=le(he);return q}(s.length,String):[],se=B.length;for(var G in s)!u&&!ce.call(s,G)||U&&(G=="length"||A&&(G=="offset"||G=="parent")||I&&(G=="buffer"||G=="byteLength"||G=="byteOffset")||lr(G,se))||B.push(G);return B}function Et(s,u){for(var f=s.length;f--;)if(Kn(s[f][0],u))return f;return-1}function He(s){return s==null?s===void 0?"[object Undefined]":"[object Null]":Me&&Me in Object(s)?function(u){var f=ce.call(u,Me),v=u[Me];try{u[Me]=void 0;var A=!0}catch{}var I=Gn.call(u);return A&&(f?u[Me]=v:delete u[Me]),I}(s):function(u){return Gn.call(u)}(s)}function Wn(s){return qe(s)&&He(s)==r}function Hn(s,u,f,v,A){return s===u||(s==null||u==null||!qe(s)&&!qe(u)?s!=s&&u!=u:function(I,U,B,se,G,z){var le=Ct(I),he=Ct(U),q=le?i:Ee(I),ge=he?i:Ee(U),Be=(q=q==r?b:q)==b,It=(ge=ge==r?b:ge)==b,Ve=q==ge;if(Ve&&nn(I)){if(!nn(U))return!1;le=!0,Be=!1}if(Ve&&!Be)return z||(z=new be),le||no(I)?qn(I,U,B,se,G,z):function(N,L,Ot,Te,on,ie,ye){switch(Ot){case j:if(N.byteLength!=L.byteLength||N.byteOffset!=L.byteOffset)return!1;N=N.buffer,L=L.buffer;case Y:return!(N.byteLength!=L.byteLength||!ie(new Jn(N),new Jn(L)));case a:case l:case p:return Kn(+N,+L);case d:return N.name==L.name&&N.message==L.message;case E:case c:return N==L+"";case g:var Ce=$o;case k:var Ke=1&Te;if(Ce||(Ce=Wo),N.size!=L.size&&!Ke)return!1;var St=ye.get(N);if(St)return St==L;Te|=2,ye.set(N,L);var Ge=qn(Ce(N),Ce(L),Te,on,ie,ye);return ye.delete(N),Ge;case y:if(tn)return tn.call(N)==tn.call(L)}return!1}(I,U,q,B,se,G,z);if(!(1&B)){var Xe=Be&&ce.call(I,"__wrapped__"),oo=It&&ce.call(U,"__wrapped__");if(Xe||oo){var fr=Xe?I.value():I,hr=oo?U.value():U;return z||(z=new be),G(fr,hr,B,se,z)}}return Ve?(z||(z=new be),function(N,L,Ot,Te,on,ie){var ye=1&Ot,Ce=Xn(N),Ke=Ce.length,St=Xn(L).length;if(Ke!=St&&!ye)return!1;for(var Ge=Ke;Ge--;){var we=Ce[Ge];if(!(ye?we in L:ce.call(L,we)))return!1}var ro=ie.get(N);if(ro&&ie.get(L))return ro==L;var xt=!0;ie.set(N,L),ie.set(L,N);for(var rn=ye;++Ge<Ke;){var Mt=N[we=Ce[Ge]],Lt=L[we];if(Te)var io=ye?Te(Lt,Mt,we,L,N,ie):Te(Mt,Lt,we,N,L,ie);if(!(io===void 0?Mt===Lt||on(Mt,Lt,Ot,Te,ie):io)){xt=!1;break}rn||(rn=we=="constructor")}if(xt&&!rn){var Nt=N.constructor,Ft=L.constructor;Nt==Ft||!("constructor"in N)||!("constructor"in L)||typeof Nt=="function"&&Nt instanceof Nt&&typeof Ft=="function"&&Ft instanceof Ft||(xt=!1)}return ie.delete(N),ie.delete(L),xt}(I,U,B,se,G,z)):!1}(s,u,f,v,Hn,A))}function sr(s){return!(!to(s)||function(u){return!!Vn&&Vn in u}(s))&&(Qn(s)?Xo:Wt).test(Fe(s))}function ur(s){if(f=(u=s)&&u.constructor,v=typeof f=="function"&&f.prototype||vt,u!==v)return er(s);var u,f,v,A=[];for(var I in Object(s))ce.call(s,I)&&I!="constructor"&&A.push(I);return A}function qn(s,u,f,v,A,I){var U=1&f,B=s.length,se=u.length;if(B!=se&&!(U&&se>B))return!1;var G=I.get(s);if(G&&I.get(u))return G==u;var z=-1,le=!0,he=2&f?new bt:void 0;for(I.set(s,u),I.set(u,s);++z<B;){var q=s[z],ge=u[z];if(v)var Be=U?v(ge,q,z,u,s,I):v(q,ge,z,s,u,I);if(Be!==void 0){if(Be)continue;le=!1;break}if(he){if(!Zo(u,function(It,Ve){if(Xe=Ve,!he.has(Xe)&&(q===It||A(q,It,f,v,I)))return he.push(Ve);var Xe})){le=!1;break}}else if(q!==ge&&!A(q,ge,f,v,I)){le=!1;break}}return I.delete(s),I.delete(u),le}function Xn(s){return function(u,f,v){var A=f(u);return Ct(u)?A:function(I,U){for(var B=-1,se=U.length,G=I.length;++B<se;)I[G+B]=U[B];return I}(A,v(u))}(s,pr,cr)}function Tt(s,u){var f,v,A=s.__data__;return((v=typeof(f=u))=="string"||v=="number"||v=="symbol"||v=="boolean"?f!=="__proto__":f===null)?A[typeof u=="string"?"string":"hash"]:A.map}function je(s,u){var f=function(v,A){return v==null?void 0:v[A]}(s,u);return sr(f)?f:void 0}Le.prototype.clear=function(){this.__data__=We?We(null):{},this.size=0},Le.prototype.delete=function(s){var u=this.has(s)&&delete this.__data__[s];return this.size-=u?1:0,u},Le.prototype.get=function(s){var u=this.__data__;if(We){var f=u[s];return f===n?void 0:f}return ce.call(u,s)?u[s]:void 0},Le.prototype.has=function(s){var u=this.__data__;return We?u[s]!==void 0:ce.call(u,s)},Le.prototype.set=function(s,u){var f=this.__data__;return this.size+=this.has(s)?0:1,f[s]=We&&u===void 0?n:u,this},fe.prototype.clear=function(){this.__data__=[],this.size=0},fe.prototype.delete=function(s){var u=this.__data__,f=Et(u,s);return!(f<0)&&(f==u.length-1?u.pop():Ko.call(u,f,1),--this.size,!0)},fe.prototype.get=function(s){var u=this.__data__,f=Et(u,s);return f<0?void 0:u[f][1]},fe.prototype.has=function(s){return Et(this.__data__,s)>-1},fe.prototype.set=function(s,u){var f=this.__data__,v=Et(f,s);return v<0?(++this.size,f.push([s,u])):f[v][1]=u,this},Ne.prototype.clear=function(){this.size=0,this.__data__={hash:new Le,map:new($e||fe),string:new Le}},Ne.prototype.delete=function(s){var u=Tt(this,s).delete(s);return this.size-=u?1:0,u},Ne.prototype.get=function(s){return Tt(this,s).get(s)},Ne.prototype.has=function(s){return Tt(this,s).has(s)},Ne.prototype.set=function(s,u){var f=Tt(this,s),v=f.size;return f.set(s,u),this.size+=f.size==v?0:1,this},bt.prototype.add=bt.prototype.push=function(s){return this.__data__.set(s,n),this},bt.prototype.has=function(s){return this.__data__.has(s)},be.prototype.clear=function(){this.__data__=new fe,this.size=0},be.prototype.delete=function(s){var u=this.__data__,f=u.delete(s);return this.size=u.size,f},be.prototype.get=function(s){return this.__data__.get(s)},be.prototype.has=function(s){return this.__data__.has(s)},be.prototype.set=function(s,u){var f=this.__data__;if(f instanceof fe){var v=f.__data__;if(!$e||v.length<199)return v.push([s,u]),this.size=++f.size,this;f=this.__data__=new Ne(v)}return f.set(s,u),this.size=f.size,this};var cr=Zn?function(s){return s==null?[]:(s=Object(s),function(u,f){for(var v=-1,A=u==null?0:u.length,I=0,U=[];++v<A;){var B=u[v];f(B,v,u)&&(U[I++]=B)}return U}(Zn(s),function(u){return Yn.call(s,u)}))}:function(){return[]},Ee=He;function lr(s,u){return!!(u=u??o)&&(typeof s=="number"||Jo.test(s))&&s>-1&&s%1==0&&s<u}function Fe(s){if(s!=null){try{return Bn.call(s)}catch{}try{return s+""}catch{}}return""}function Kn(s,u){return s===u||s!=s&&u!=u}(Xt&&Ee(new Xt(new ArrayBuffer(1)))!=j||$e&&Ee(new $e)!=g||Kt&&Ee(Kt.resolve())!=R||Qt&&Ee(new Qt)!=k||en&&Ee(new en)!=M)&&(Ee=function(s){var u=He(s),f=u==b?s.constructor:void 0,v=f?Fe(f):"";if(v)switch(v){case tr:return j;case nr:return g;case or:return R;case rr:return k;case ir:return M}return u});var dr=Wn(function(){return arguments}())?Wn:function(s){return qe(s)&&ce.call(s,"callee")&&!Yn.call(s,"callee")},Ct=Array.isArray,nn=Qo||function(){return!1};function Qn(s){if(!to(s))return!1;var u=He(s);return u==h||u=="[object GeneratorFunction]"||u=="[object AsyncFunction]"||u=="[object Proxy]"}function eo(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=o}function to(s){var u=typeof s;return s!=null&&(u=="object"||u=="function")}function qe(s){return s!=null&&typeof s=="object"}var no=Rn?function(s){return function(u){return s(u)}}(Rn):function(s){return qe(s)&&eo(s.length)&&!!P[He(s)]};function pr(s){return(u=s)!=null&&eo(u.length)&&!Qn(u)?ar(s):ur(s);var u}e.exports=function(s,u){return Hn(s,u)}})($t,$t.exports);var Ln=F($t.exports);function Nn(e,t){return e.length===t.length&&JSON.stringify(e.map(function(n){return n}).sort())===JSON.stringify(t.map(function(n){return n}).sort())}var Vo={Polygon:oe,LineString:de,Point:Ie,MultiPolygon:K,MultiLineString:K,MultiPoint:K},Go=Object.freeze({__proto__:null,CommonSelectors:To,constrainFeatureMovement:Yt,createMidPoint:vn,createSupplementaryPoints:ct,createVertex:Ue,doubleClickZoom:ae,euclideanDistance:Rt,featuresAt:De,getFeatureAtAndSetCursors:nt,isClick:Ut,isEventAtCoordinates:yt,isTap:kt,mapEventToBoundingBox:dn,ModeHandler:S,moveFeatures:Zt,sortFeatures:ln,stringSetsAreEqual:Nn,StringSet:ne,theme:yn,toDenseArray:Ye}),zo=function(e,t){var n={options:e=function(r){r===void 0&&(r={});var i=ve(r);return r.controls||(i.controls={}),r.displayControlsDefault===!1?i.controls=ve(Bo,r.controls):i.controls=ve(jo,r.controls),(i=ve(ko,i)).styles=Mn(i.styles,"cold").concat(Mn(i.styles,"hot")),i}(e)};t=function(r,i){return i.modes=C,i.getFeatureIdsAt=function(a){return De.click({point:a},null,r).map(function(l){return l.properties.id})},i.getSelectedIds=function(){return r.store.getSelectedIds()},i.getSelected=function(){return{type:_.FEATURE_COLLECTION,features:r.store.getSelectedIds().map(function(a){return r.store.get(a)}).map(function(a){return a.toGeoJSON()})}},i.getSelectedPoints=function(){return{type:_.FEATURE_COLLECTION,features:r.store.getSelectedCoordinates().map(function(a){return{type:_.FEATURE,properties:{},geometry:{type:_.POINT,coordinates:a.coordinates}}})}},i.set=function(a){if(a.type===void 0||a.type!==_.FEATURE_COLLECTION||!Array.isArray(a.features))throw new Error("Invalid FeatureCollection");var l=r.store.createRenderBatch(),d=r.store.getAllIds().slice(),h=i.add(a),g=new ne(h);return(d=d.filter(function(p){return!g.has(p)})).length&&i.delete(d),l(),h},i.add=function(a){var l=JSON.parse(JSON.stringify(So(a))).features.map(function(d){if(d.id=d.id||Bt(),d.geometry===null)throw new Error("Invalid geometry: null");if(r.store.get(d.id)===void 0||r.store.get(d.id).type!==d.geometry.type){var h=Vo[d.geometry.type];if(h===void 0)throw new Error("Invalid geometry type: "+d.geometry.type+".");var g=new h(r,d);r.store.add(g)}else{var p=r.store.get(d.id);p.properties=d.properties,Ln(p.properties,d.properties)||r.store.featureChanged(p.id),Ln(p.getCoordinates(),d.geometry.coordinates)||p.incomingCoords(d.geometry.coordinates)}return d.id});return r.store.render(),l},i.get=function(a){var l=r.store.get(a);if(l)return l.toGeoJSON()},i.getAll=function(){return{type:_.FEATURE_COLLECTION,features:r.store.getAll().map(function(a){return a.toGeoJSON()})}},i.delete=function(a){return r.store.delete(a,{silent:!0}),i.getMode()!==C.DIRECT_SELECT||r.store.getSelectedIds().length?r.store.render():r.events.changeMode(C.SIMPLE_SELECT,void 0,{silent:!0}),i},i.deleteAll=function(){return r.store.delete(r.store.getAllIds(),{silent:!0}),i.getMode()===C.DIRECT_SELECT?r.events.changeMode(C.SIMPLE_SELECT,void 0,{silent:!0}):r.store.render(),i},i.changeMode=function(a,l){return l===void 0&&(l={}),a===C.SIMPLE_SELECT&&i.getMode()===C.SIMPLE_SELECT?(Nn(l.featureIds||[],r.store.getSelectedIds())||(r.store.setSelected(l.featureIds,{silent:!0}),r.store.render()),i):(a===C.DIRECT_SELECT&&i.getMode()===C.DIRECT_SELECT&&l.featureId===r.store.getSelectedIds()[0]||r.events.changeMode(a,l,{silent:!0}),i)},i.getMode=function(){return r.events.getMode()},i.trash=function(){return r.events.trash({silent:!0}),i},i.combineFeatures=function(){return r.events.combineFeatures({silent:!0}),i},i.uncombineFeatures=function(){return r.events.uncombineFeatures({silent:!0}),i},i.setFeatureProperty=function(a,l,d){return r.store.setFeatureProperty(a,l,d),i},i}(n,t),n.api=t;var o=Eo(n);return t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=X,t.options=e,t};function mt(e){zo(e,this)}return mt.modes=xn,mt.constants=lo,mt.lib=Go,mt})})(ao);var mr=ao.exports;const so=yr(mr),ze="select_feature",tt=`${ze}_highlight`,vr={highlightColor:"#222"},uo=so.constants,_r=so.lib,Ae={};Ae.onSetup=function(m){const{selectHighlightColor:O,onSelect:S,onCancel:F}=m,x={};x.hoveredFeatureID=null,x.selectedFeatureID=null,x.onSelect=S,x.onCancel=F,x.api=this._ctx.api;const{selectHighlightColor:Z=vr.highlightColor}=this._ctx.options;return x.options={selectHighlightColor:O||Z},x};Ae.onMouseMove=function(m,O){const{api:S}=m,{featureTarget:F}=O;if(F){this.updateUIClasses({mouse:uo.cursors.POINTER});const x=F.properties.id;m.hoveredFeatureID!==null&&m.hoveredFeatureID!==x&&S.setFeatureProperty(m.hoveredFeatureID,tt,void 0),m.hoveredFeatureID=x,S.setFeatureProperty(m.hoveredFeatureID,tt,m.options.selectHighlightColor)}else m.hoveredFeatureID&&S.setFeatureProperty(m.hoveredFeatureID,tt,void 0),m.hoveredFeatureID=null};Ae.onClick=function(m,O){m.selectedFeatureID=m.hoveredFeatureID,this.onStop(m,O)};Ae.toDisplayFeatures=function(m,O,S){S(O)};Ae.onKeyUp=function(m,O){CommonSelectors.isEscapeKey(O)&&typeof m.onCancel=="function"&&setTimeout(m.onCancel,0)};Ae.onStop=function(m){this.updateUIClasses({mouse:uo.cursors.NONE}),_r.doubleClickZoom.enable(this),this.activateUIButton(),m.selectedFeatureID?(typeof m.onSelect=="function"?setTimeout(m.onSelect.bind(null,m.selectedFeatureID),0):this.map.fire("draw.select_mode.select",{featureID:m.selectedFeatureID}),m.selectedFeatureID=null):typeof m.onCancel=="function"&&setTimeout(m.onCancel,0),m.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(m.hoveredFeatureID,tt,void 0),m.hoveredFeatureID=null)};const me=`user_${tt}`,br=m=>m.concat([{id:`${ze}-fill`,type:"fill",filter:["all",["==","$type","Polygon"],["has",me]],paint:{"fill-color":["get",me],"fill-outline-color":["get",me],"fill-opacity":.2}},{id:`${ze}-stroke`,type:"line",filter:["all",["==","$type","Polygon"],["has",me]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",me],"line-dasharray":[.2,2],"line-width":2}},{id:`${ze}-line`,type:"line",filter:["all",["==","$type","LineString"],["has",me]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",me],"line-dasharray":[.2,2],"line-width":2}},{id:`${ze}-point`,type:"circle",filter:["all",["==","$type","Point"],["has",me]],paint:{"circle-color":["get",me],"circle-radius":3}}]);function Er(m){return{...m,[ze]:Ae}}let et,Pe,co;const Tr=()=>{try{Pe==null||Pe.changeMode("select_feature",{onSelect(m){alert(`Selected Feature ID: ${m}`)}})}catch(m){alert(m.message),console.error(m)}};class Cr{constructor(O){let S=this;S.draw=O.draw,S.buttons=O.buttons||[],S.onAddOrig=O.draw.onAdd,S.onRemoveOrig=O.draw.onRemove}onAdd(O){let S=this;return S.map=O,S.elContainer=S.onAddOrig(O),S.buttons.forEach(F=>{S.addButton(F)}),S.elContainer}onRemove(O){let S=this;S.buttons.forEach(F=>{S.removeButton(F)}),S.onRemoveOrig(O)}addButton(O){let S=this;var F=document.createElement("button");F.className="mapbox-gl-draw_ctrl-draw-btn",O.classes instanceof Array&&O.classes.forEach(x=>{F.classList.add(x)}),F.addEventListener(O.on,O.action),S.elContainer.appendChild(F),O.elButton=F}removeButton(O){O.elButton.removeEventListener(O.on,O.action),O.elButton.remove()}}mapboxgl.getRTLTextPluginStatus()==="unavailable"&&mapboxgl.setRTLTextPlugin("https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js",m=>{m&&console.error(m)},!0);et=new mapboxgl.Map({container:"map",style:"https://map.ir/vector/styles/main/mapir-xyz-light-style.json",center:[51.3857,35.6102],zoom:7.78,pitch:0,interactive:!0,hash:!0,attributionControl:!0,customAttribution:"© Map © Openstreetmap",transformRequest:m=>({url:m,headers:{"x-api-key":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImRiZWU0YWU4OTk4OTA3MmQ3OTFmMjQ4ZDE5N2VhZTgwZWU2NTUyYjhlYjczOWI2NDdlY2YyYzIzNWRiYThiMzIzOTM5MDkzZDM0NTY2MmU3In0.eyJhdWQiOiI5NDMyIiwianRpIjoiZGJlZTRhZTg5OTg5MDcyZDc5MWYyNDhkMTk3ZWFlODBlZTY1NTJiOGViNzM5YjY0N2VjZjJjMjM1ZGJhOGIzMjM5MzkwOTNkMzQ1NjYyZTciLCJpYXQiOjE1OTA4MjU0NzIsIm5iZiI6MTU5MDgyNTQ3MiwiZXhwIjoxNTkzNDE3NDcyLCJzdWIiOiIiLCJzY29wZXMiOlsiYmFzaWMiXX0.M_z4xJlJRuYrh8RFe9UrW89Y_XBzpPth4yk3hlT-goBm8o3x8DGCrSqgskFfmJTUD2wC2qSoVZzQKB67sm-swtD5fkxZO7C0lBCMAU92IYZwCdYehIOtZbP5L1Lfg3C6pxd0r7gQOdzcAZj9TStnKBQPK3jSvzkiHIQhb6I0sViOS_8JceSNs9ZlVelQ3gs77xM2ksWDM6vmqIndzsS-5hUd-9qdRDTLHnhdbS4_UBwNDza47Iqd5vZkBgmQ_oDZ7dVyBuMHiQFg28V6zhtsf3fijP0UhePCj4GM89g3tzYBOmuapVBobbX395FWpnNC3bYg7zDaVHcllSUYDjGc1A","Mapir-SDK":"reactjs"}})});Pe=new MapboxDraw({modes:{...Er(MapboxDraw.modes)},styles:[...br(gr)],userProperties:!0,selectHighlightColor:"red"});window.draw=Pe;co=new Cr({draw:Pe,buttons:[{on:"click",action:Tr,classes:["select-icon"]}]});et.once("load",()=>{et.resize(),et.addControl(co,"top-right"),Pe.set({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{coordinates:[[[51.03172414839912,35.920869678862005],[51.03172414839912,35.62049410212656],[51.461567534481134,35.62049410212656],[51.461567534481134,35.920869678862005],[51.03172414839912,35.920869678862005]]],type:"Polygon"}},{type:"Feature",properties:{},geometry:{coordinates:[[51.6404618916944,35.57806814108352],[51.82929482430853,35.860482623322696]],type:"LineString"}},{type:"Feature",properties:{},geometry:{coordinates:[51.40193608207707,35.45267939803206],type:"Point"}}]}),et.on("draw.update",function(m){console.log("🚀 ~ file: index.js ~ line 158 ~ e",m)})});
